<% for(var i=0;i<article.length;i++) { %>
<article id="article" class="post clear">
	<header class="article_header">
		<h1>
			<a title="<%= article[i].title %>" href="/article/<%= article[i].title %>"><%= article[i].title %></a>
		</h1>
		<div class="article_data">
			<% var t = article[i].publishtime;
				 var tm = t.getMinutes() < 10? '0'+t.getMinutes() : t.getMinutes();
				 var tyue =  t.getMonth() + 1;
				 var time = t.getFullYear()+'-'+tyue+'-' + t.getDate()+'  '+ t.getHours() +':'+ tm ;%>
			<div class="article_post_date">
				<span class="article_post_date_link"><%= time %></span>
			</div>
			<div class="article_post_tag">
				<% if(article[i].tag.name){ %>
					<a title="view all articles in <%= article[i].tag.name %>" href="/tag/<%= article[i].tag[j]._id %>"><%= article[i].tag.name %></a>
				<%} else if(article[i].tag.length > 0){%>
					<% for(var j = 0; j < article[i].tag.length; j++) {%>
						<a class="article_tag_style" title="view all articles in <%= article[i].tag[j].name%>" href="/tag/<%= article[i].tag[j]._id %>">#<%= article[i].tag[j].name %></a>
					<% } %>
				<% } %>
			</div>
		</div>
	</header>
	<div class="article_content">
		<%- article[i].content %>
	</div>
</article>
<% } %>

<div class="pagination" current_page = "<%= current_page %>">
	<ul>
		<% var base_url = base + (base.indexOf('?') < 0 ? '?' : '&') + 'page= '; %>
		<% if(current_page == 1) { %>
		<li class="disabled"><a>«</a></li>
		<% } else { %>
		<li><a href="<%= base_url %>1">«</a></li>
		<% } %>

		<% var page_start = current_page - 2 > 0 ? current_page - 2 : 1;
			 var page_end =  page_start + 4 >= pages? pages : page_start + 4; %>
		<% if(page_start > 1){ %>
		<li><a>....</a></li>
		<% } %>

		<% for(var i = page_start; i <= page_end; i++) { %>
			<% if(i === current_page) { %>
		<li class="disabled"><a><%= i %></a></li>
				<% } else { %>
		<li><a href="<%= base_url + i %>"><%= i %></a></li>		
				<% } %>
		<% } %>

		<% if(page_end < pages ){ %>
		<li><a>...</a></li>
		<% } %>

		<% if(current_page == pages) { %>
		<li class="disabled"><a>»</a></li>
		<% } else { %>
		<li><a href="<%= base_url + pages %>">»</a></li>
		<% } %>
	</ul>
</div> 

<script type="text/javascript">
	$(document).ready(function(){
		prettyPrint();
		var $nav = $('.pagination');
		var current_page = $nav.attr('current_page');
		if(current_page){
			$nav.find('li').each(function(){
				var $li = $(this);
				var $a = $li.find('a');
				if($a.html() == current_page){
					$li.addClass('active');
					$a.removeAttr('href');
				}
			});
		}
	});
</script>